<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QuizForge</title>
  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
  <style>
    :root {
      --primary: #4F46E5;
      --primary-hover: #4338CA;
      --surface-light: #FFFFFF;
      --border: #E5E7EB;
      --text-primary: #111827;
      --bg-light: #F9FAFB;
    }
    /* Base Reset & Fonts */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
      background-color: var(--bg-light);
      color: var(--text-primary);
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    /* Hamburger Menu & Side Navigation */
    .hamburger {
      position: fixed;
      top: 1rem;
      left: 1rem;
      z-index: 1100;
      cursor: pointer;
    }
    .hamburger span {
      display: block;
      width: 25px;
      height: 3px;
      background: var(--primary);
      margin: 5px 0;
      transition: all 0.3s ease;
    }
    .side-menu {
      position: fixed;
      top: 0;
      left: -250px;
      width: 250px;
      height: 100%;
      background: var(--surface-light);
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1000;
      transition: left 0.3s ease;
    }
    .side-menu.active {
      left: 0;
    }
    .side-menu ul {
      list-style: none;
      padding: 2rem 1rem;
    }
    .side-menu ul li {
      margin-bottom: 1rem;
    }
    .side-menu ul li a {
      font-size: 1.2rem;
      transition: font-weight 0.3s;
    }
    .side-menu ul li a.active {
      font-weight: bold;
    }
    /* Main Container & Sections */
    .container {
      max-width: 1000px;
      margin: 4rem auto 2rem;
      padding: 0 1rem;
    }
    section {
      display: none;
      animation-duration: 0.5s;
      padding: 2rem 0;
    }
    section.active {
      display: block;
    }
    /* Home Section (Hero) */
    #home {
      text-align: center;
      padding: 4rem 1rem;
    }
    .hero {
      background: linear-gradient(135deg, var(--primary), var(--primary-hover));
      color: white;
      padding: 4rem 1rem;
      border-radius: 1rem;
      margin-bottom: 2rem;
    }
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    .cta-buttons {
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
    }
    .cta-buttons button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 0.375rem;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s, box-shadow 0.2s, transform 0.1s;
    }
    .cta-buttons button:hover {
      background-color: var(--primary-hover);
    }
    .cta-buttons button:active {
      transform: scale(0.98);
    }
    /* Features Section */
    #features {
      padding: 2rem 1rem;
    }
    #features h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #features p {
      max-width: 800px;
      margin: 0.5rem auto;
      text-align: justify;
    }
    /* About Us Section */
    #about {
      padding: 2rem 1rem;
      background: #f0f0f0;
      border-radius: 0.5rem;
      max-width: 800px;
      margin: 2rem auto;
    }
    #about h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #about p {
      margin-bottom: 1rem;
      text-align: justify;
    }
    #about .contact {
      margin-top: 2rem;
      border-top: 1px solid var(--border);
      padding-top: 1rem;
      font-weight: bold;
      text-align: center;
    }
    /* FAQ Section */
    #faq h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .faq-item {
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    .faq-question {
      padding: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #f9f9f9;
    }
    .faq-answer {
      padding: 0 1rem 1rem;
      display: none;
    }
    /* Auth Section */
    #auth {
      padding: 2rem 1rem;
      background: var(--surface-light);
      border-radius: 0.5rem;
      max-width: 400px;
      margin: 2rem auto;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    #auth h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    .auth-tabs {
      display: flex;
      margin-bottom: 1.5rem;
    }
    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 0.75rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: border-color 0.2s;
    }
    .auth-tab.active {
      border-color: var(--primary);
    }
    .auth-form {
      display: none;
    }
    .auth-form.active {
      display: block;
    }
    #auth input {
      width: 100%;
      padding: 0.625rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      font-size: 1rem;
    }
    #auth button {
      width: 100%;
      padding: 0.75rem;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 0.375rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #auth button:hover {
      background-color: var(--primary-hover);
    }
    /* Generator Section */
    #generator {
      padding: 2rem 1rem;
      background: var(--surface-light);
      border-radius: 0.5rem;
      margin: 2rem auto;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    #generator h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
    #generator .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }
    #generator .form-group {
      margin-bottom: 1.25rem;
    }
    #generator label {
      display: block;
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
    }
    #generator input[type="text"],
    #generator input[type="password"],
    #generator input[type="email"],
    #generator select,
    #generator textarea {
      width: 100%;
      padding: 0.625rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      font-size: 0.9rem;
      transition: border-color 0.2s;
    }
    #generator input:focus,
    #generator select:focus,
    #generator textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(79,70,229,0.1);
    }
    #generator textarea {
      min-height: 100px;
      resize: vertical;
    }
    #generator .question-types {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    #generator .question-type {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      background-color: var(--bg-light);
    }
    #generator .question-type input[type="checkbox"] {
      margin-right: 0.75rem;
      cursor: pointer;
    }
    #generator .question-type input[type="number"] {
      width: 50px;
      padding: 0.25rem;
      text-align: center;
      border: 1px solid var(--border);
      border-radius: 0.25rem;
    }
    #generator button {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 0.375rem;
      padding: 0.625rem 1.25rem;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      margin: 0.25rem 0;
    }
    #generator button:hover {
      background-color: var(--primary-hover);
    }
    #generator button:active {
      transform: scale(0.98);
    }
    #generator button:disabled {
      background-color: #9CA3AF;
      cursor: not-allowed;
    }
    #generator .button-group {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }
    #generator #output {
      background-color: #F3F4F6;
      padding: 1rem;
      border-radius: 0.375rem;
      margin-top: 1.5rem;
      font-size: 0.9rem;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    #generator .status {
      padding: 0.75rem;
      border-radius: 0.375rem;
      margin: 1rem 0;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }
    #generator .status.error {
      background-color: #FEE2E2;
      color: #DC2626;
    }
    #generator .status.success {
      background-color: #D1FAE5;
      color: #059669;
    }
    #generator .status.info {
      background-color: #E0F2FE;
      color: #0369A1;
    }
    #generator .loader {
      display: none;
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    /* Footer */
    footer {
      text-align: center;
      font-size: 0.75rem;
      padding: 1rem 0;
      border-top: 1px solid var(--border);
    }
    /* Responsive */
    @media (max-width: 768px) {
      .cta-buttons { flex-direction: column; }
      .side-menu { width: 200px; }
      #generator .grid-2 { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- Hamburger Menu -->
  <div class="hamburger" onclick="toggleMenu()">
    <span></span>
    <span></span>
    <span></span>
  </div>
  <nav id="side-menu" class="side-menu">
    <ul>
      <li><a href="#home" onclick="navigateTo('home'); toggleMenu()" id="nav-home">Home</a></li>
      <li><a href="#features" onclick="navigateTo('features'); toggleMenu()" id="nav-features">Features</a></li>
      <li><a href="#about" onclick="navigateTo('about'); toggleMenu()" id="nav-about">About Us</a></li>
      <li><a href="#auth" onclick="navigateTo('auth'); toggleMenu()" id="nav-auth">Auth</a></li>
      <li><a href="#faq" onclick="navigateTo('faq'); toggleMenu()" id="nav-faq">FAQ</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="container">
    <!-- Home Section -->
    <section id="home" class="active animate__animated animate__fadeIn">
      <div class="hero">
        <h1>Welcome to QuizForge</h1>
        <p>Create professional exams in minutes with our AI-powered generator.</p>
        <div class="cta-buttons">
          <!-- Button to navigate to the Generator section -->
          <button onclick="navigateTo('auth')">Get Started</button>
        </div>
      </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="animate__animated">
      <h2>Features</h2>
      <p>
        QuizForge offers an intuitive exam generator that makes creating tests a breeze. With responsive design and AI-powered content creation, educators can quickly craft comprehensive exams complete with multiple choice, short answer, essay, and true/false questions.
      </p>
      <p>
        Our platform leverages cutting-edge tools such as Supabase, jsPDF, html2canvas, Docx, and Marked. This integration ensures that your exams are professional, exportable in various formats, and delivered with the highest quality.
      </p>
    </section>

    <!-- About Us Section -->
    <section id="about" class="animate__animated">
      <h2>About Us</h2>
      <p>
        Naoussi Industries is passionately dedicated to empowering educators and innovators. We pride ourselves on our commitment to quality and continuous technological advancement. Our visionary founder, PDG TEDJOUONG NAOUSSI Ange Lionel, has poured his heart and soul into developing QuizForge—an app designed to revolutionize exam creation.
      </p>
      <p>
        With boundless enthusiasm and a drive for excellence, we work relentlessly to push the boundaries of educational technology. Our mission is to inspire both teachers and students by providing a tool that is not only powerful but also user-friendly and efficient.
      </p>
      <div class="contact">
        Contact Us: Tel: +237 658120586 | Email: naoussilionel8@gmail.com
      </div>
    </section>

    <!-- Auth Section -->
    <section id="auth" class="animate__animated">
      <h2>Authentication</h2>
      <div class="auth-card">
        <div class="auth-tabs">
          <div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
          <div class="auth-tab" onclick="switchAuthTab('register')">Register</div>
        </div>
        <form id="login-form" class="auth-form active">
          <input type="email" placeholder="Email" required>
          <input type="password" placeholder="Password" required>
          <button type="submit">Login</button>
        </form>
        <form id="register-form" class="auth-form">
          <input type="email" placeholder="Email" required>
          <input type="password" placeholder="Password" required>
          <input type="password" placeholder="Confirm Password" required>
          <button type="submit">Create Account</button>
        </form>
      </div>
    </section>

    <!-- FAQ Section -->
    <section id="faq" class="animate__animated">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-item">
        <div class="faq-question" onclick="toggleFAQ(this)">
          How do I save my generated exams?
          <span>▼</span>
        </div>
        <div class="faq-answer">
          <p>Your exams are automatically stored in our secure cloud—ensuring you never lose your hard work.</p>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question" onclick="toggleFAQ(this)">
          Can I export my exam paper in different formats?
          <span>▼</span>
        </div>
        <div class="faq-answer">
          <p>Absolutely! You can export your exams as PDF, Word, or TXT documents with just one click.</p>
        </div>
      </div>
      <div class="faq-item">
        <div class="faq-question" onclick="toggleFAQ(this)">
          Which third-party tools power QuizForge?
          <span>▼</span>
        </div>
        <div class="faq-answer">
          <p>Our platform is powered by innovative tools including Supabase, jsPDF, html2canvas, Docx, and Marked, ensuring a smooth exam generation process.</p>
        </div>
      </div>
    </section>
    
    <!-- Generator Section -->
    <section id="generator" class="animate__animated">
      <h2>Exam Generator</h2>
      <div id="generator-form" class="card">
        <div class="grid-2">
          <div class="form-group">
            <label for="class">Class/Grade</label>
            <input type="text" id="class" placeholder="e.g. Form 1" value="Form 1" required />
          </div>
          <div class="form-group">
            <label for="subject">Subject</label>
            <input type="text" id="subject" placeholder="e.g. Mathematics" value="Mathematics" required />
          </div>
        </div>
        <div class="form-group">
          <label for="language">Language</label>
          <select id="language">
            <option value="English">English</option>
            <option value="French">French</option>
            <option value="Spanish">Spanish</option>
            <option value="Arabic">Arabic</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Topics <button type="button" onclick="addTopic()">+ Add Topic</button></label>
          <div id="topics-container">
            <div class="topic-item">
              <input type="text" placeholder="Enter topic" class="topic-input" required />
              <span onclick="removeTopic(this)" style="cursor:pointer;">✕</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="additional-details">Additional Instructions</label>
          <textarea id="additional-details" placeholder="Special instructions, exam duration, etc."></textarea>
        </div>
        <div class="form-group">
          <label>Question Types</label>
          <div class="question-types">
            <div class="question-type">
              <input type="checkbox" id="mcq" checked />
              <label for="mcq">Multiple Choice</label>
              <input type="number" id="mcq-count" min="1" max="20" value="5" />
            </div>
            <div class="question-type">
              <input type="checkbox" id="short-answer" checked />
              <label for="short-answer">Short Answer</label>
              <input type="number" id="short-answer-count" min="1" max="20" value="5" />
            </div>
            <div class="question-type">
              <input type="checkbox" id="essay" />
              <label for="essay">Essay</label>
              <input type="number" id="essay-count" min="1" max="5" value="2" />
            </div>
            <div class="question-type">
              <input type="checkbox" id="true-false" />
              <label for="true-false">True/False</label>
              <input type="number" id="true-false-count" min="1" max="20" value="5" />
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="separate-answer-sheet" checked />
            Generate separate answer sheet
          </label>
        </div>
        <div class="form-group">
          <label for="filename">File Name (without extension)</label>
          <input type="text" id="filename" placeholder="e.g. Math_Exam_2025" />
        </div>
        <div class="toggle-container" style="margin: 1rem 0;">
          <input type="checkbox" id="rawOutputToggle" />
          <label for="rawOutputToggle">Display output as raw text (DOCX style)</label>
        </div>
        <div class="button-group">
          <button id="generateBtn" onclick="generateQuestions()">Generate Exam Paper</button>
          <button id="downloadPdfBtn" onclick="downloadPDF()" disabled>Download PDF</button>
          <button id="downloadWordBtn" onclick="downloadWord()" disabled>Download Word</button>
          <button id="downloadTxtBtn" onclick="downloadTXT()" disabled>Download TXT</button>
        </div>
        <div id="status" class="status info">Ready to generate</div>
        <div id="loader" class="loader"></div>
      </div>
      <div id="output"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>© Naoussi Industries. All rights reserved.</p>
  </footer>

  <!-- JavaScript for Navigation, Auth & Generator Interaction -->
  <script>
    // Toggle hamburger menu visibility
    function toggleMenu() {
      document.getElementById('side-menu').classList.toggle('active');
    }
    // Smoothly navigate to a section and highlight its nav link
    function navigateTo(sectionId) {
      document.querySelectorAll('.side-menu ul li a').forEach(link => link.classList.remove('active'));
      const activeLink = document.getElementById('nav-' + sectionId);
      if (activeLink) {
        activeLink.classList.add('active');
      }
      document.querySelectorAll('main section').forEach(sec => sec.classList.remove('active'));
      const target = document.getElementById(sectionId);
      if (target) {
        target.classList.add('active', 'animate__fadeIn');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }
    // FAQ toggle functionality
    function toggleFAQ(element) {
      const answer = element.nextElementSibling;
      if (answer.style.display === "block") {
        answer.style.display = "none";
        element.querySelector("span").textContent = "▼";
      } else {
        answer.style.display = "block";
        element.querySelector("span").textContent = "▲";
      }
    }
    // ---------- Auth (Sign In / Register) Functions ----------
    function switchAuthTab(type) {
      document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
      document.getElementById(type + "-form").classList.add('active');
      document.querySelector(`[onclick="switchAuthTab('${type}')"]`).classList.add('active');
    }
    const SUPABASE_URL = 'https://qnkockslvplcviyvuvft.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFua29ja3NsdnBsY3ZpeXZ1dmZ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM3MTc3MzMsImV4cCI6MjA1OTI5MzczM30.TNx8MW2b-xOsKKtblqQQrdwDmpY50OtxXxShh0blbvU';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    let currentUser = null;
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = e.target[0].value;
      const password = e.target[1].value;
      const { error, data } = await supabase.auth.signInWithPassword({ email, password });
      if (error) return alert(error.message);
      currentUser = data.user;
      alert("Login successful!");
      navigateTo('generator');
    });
    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = e.target[0].value;
      const password = e.target[1].value;
      const confirmPassword = e.target[2].value;
      if (password !== confirmPassword) return alert('Passwords do not match!');
      const { error } = await supabase.auth.signUp({ email, password });
      if (error) return alert(error.message);
      alert('Registration successful! Please check your email for verification.');
      navigateTo('generator');
    });
    // ---------- Exam Generator Functions ----------
    const output = document.getElementById('output');
    const status = document.getElementById('status');
    const generateBtn = document.getElementById('generateBtn');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const downloadWordBtn = document.getElementById('downloadWordBtn');
    const downloadTxtBtn = document.getElementById('downloadTxtBtn');
    const loader = document.getElementById('loader');
    const rawOutputToggle = document.getElementById('rawOutputToggle');
    let generatedContent = { questions: "", answers: "" };
    function showError(message) {
      status.className = "status error";
      status.textContent = message;
      status.scrollIntoView({ behavior: "smooth", block: "center" });
    }
    function showStatus(message, type = "info") {
      status.className = `status ${type}`;
      status.textContent = message;
    }
    function getTopics() {
      const topicInputs = document.querySelectorAll(".topic-input");
      return Array.from(topicInputs).map(input => input.value.trim()).filter(Boolean);
    }
    function addTopic() {
      const container = document.getElementById("topics-container");
      const newTopic = document.createElement("div");
      newTopic.className = "topic-item";
      newTopic.innerHTML = `
        <input type="text" placeholder="Enter topic" class="topic-input" required>
        <span onclick="removeTopic(this)" style="cursor:pointer;">✕</span>
      `;
      container.appendChild(newTopic);
      newTopic.querySelector("input").focus();
    }
    function removeTopic(element) {
      const container = document.getElementById("topics-container");
      if (container.children.length > 1) {
        element.parentElement.remove();
      } else {
        showError("At least one topic is required");
      }
    }
    function getFilename() {
      let filename = document.getElementById("filename").value.trim();
      if (!filename) {
        const subject = document.getElementById("subject").value.trim().replace(/\s+/g, "_");
        const date = new Date().toISOString().split("T")[0];
        filename = `${subject}_Exam_${date}`;
      }
      return filename;
    }
    async function generateQuestions() {
      const grade = document.getElementById("class").value;
      const subject = document.getElementById("subject").value.trim();
      const language = document.getElementById("language").value;
      const topics = getTopics();
      const additionalDetails = document.getElementById("additional-details").value;
      const separateAnswerSheet = document.getElementById("separate-answer-sheet").checked;
      const questionTypes = [];
      if (document.getElementById("mcq").checked) {
        questionTypes.push({ type: "Multiple Choice", count: parseInt(document.getElementById("mcq-count").value) || 5 });
      }
      if (document.getElementById("short-answer").checked) {
        questionTypes.push({ type: "Short Answer", count: parseInt(document.getElementById("short-answer-count").value) || 5 });
      }
      if (document.getElementById("essay").checked) {
        questionTypes.push({ type: "Essay", count: parseInt(document.getElementById("essay-count").value) || 2 });
      }
      if (document.getElementById("true-false").checked) {
        questionTypes.push({ type: "True/False", count: parseInt(document.getElementById("true-false-count").value) || 5 });
      }
      if (!subject) {
        showError("Please enter a subject");
        document.getElementById("subject").focus();
        return;
      }
      if (topics.length === 0) {
        showError("Please add at least one topic");
        return;
      }
      if (questionTypes.length === 0) {
        showError("Please select at least one question type");
        return;
      }
      generateBtn.disabled = true;
      downloadPdfBtn.disabled = true;
      downloadWordBtn.disabled = true;
      downloadTxtBtn.disabled = true;
      showStatus("Generating exam paper...");
      output.textContent = "";
      loader.style.display = "block";
      try {
        let prompt = `Create a comprehensive ${language} exam paper for ${grade} ${subject} covering these topics: ${topics.join(", ")}.\n`;
        questionTypes.forEach(q => {
          prompt += `- ${q.count} ${q.type} questions\n`;
        });
        prompt += `\nFormat requirements:
 * Begin with a school information section (blanks for school name, date, etc.)
 * Include clear student instructions
 * For Multiple Choice: provide 4 options (A-D) and mark the correct answer
 * For True/False: clearly mark (T/F)
 * Group questions by type with section headings
 * ${separateAnswerSheet ? "Put all answers in a separate section at the end" : "Include answers immediately after each question"}
 * Additional details: ${additionalDetails || "None"}`;
        const response = await fetch("https://api.deepinfra.com/v1/openai/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer QCxoUtN1zmRL0QXniy9FK8fO4uccrDsy`
          },
          body: JSON.stringify({
            model: "mistralai/Mistral-7B-Instruct-v0.1",
            messages: [{ role: "user", content: prompt }],
            max_tokens: 3000,
            temperature: 0.7
          })
        });
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || `API request failed with status ${response.status}`);
        }
        const data = await response.json();
        if (!data.choices || !data.choices[0] || !data.choices[0].message) {
          throw new Error("Invalid response format from API");
        }
        const content = data.choices[0].message.content;
        generatedContent = parseApiResponse(content, separateAnswerSheet);
        if (rawOutputToggle.checked) {
          output.textContent = generatedContent.questions;
          if (!separateAnswerSheet && generatedContent.answers) {
            output.textContent += "\n\n---------------------\n\n" + generatedContent.answers;
          }
        } else {
          output.innerHTML = marked.parse(generatedContent.questions);
          if (!separateAnswerSheet && generatedContent.answers) {
            output.innerHTML += "<hr>" + marked.parse(generatedContent.answers);
          }
        }
        downloadPdfBtn.disabled = false;
        downloadWordBtn.disabled = false;
        downloadTxtBtn.disabled = false;
        showStatus("Exam paper generated successfully!", "success");
      } catch (error) {
        console.error("Generation error:", error);
        showError(`Failed to generate exam: ${error.message}`);
      } finally {
        loader.style.display = "none";
        generateBtn.disabled = false;
      }
    }
    function parseApiResponse(content, separateAnswerSheet) {
      let questions = content;
      let answers = "";
      if (!content || typeof content !== "string") {
        return { questions: "No content generated", answers: "" };
      }
      const answerMarkers = [
        "\nANSWERS:\n",
        "\nANSWER KEY:\n",
        "\nSOLUTIONS:\n",
        "\n--- Answers ---\n",
        "\nCorrect Answers:\n",
        "\nAnswer Key:\n"
      ];
      for (const marker of answerMarkers) {
        if (content.includes(marker)) {
          const parts = content.split(marker);
          questions = parts[0].trim();
          answers = parts.slice(1).join(marker).trim();
          return { questions, answers };
        }
      }
      if (separateAnswerSheet) {
        const answerPattern = /(Answer|Correct answer|Solution):?\s*(.*)/gi;
        const matches = [...content.matchAll(answerPattern)];
        if (matches.length > 0) {
          answers = matches.map(match => match[0]).join("\n");
        } else {
          answers = "Answers embedded in questions";
        }
      }
      return { questions: questions.trim(), answers: answers.trim() };
    }
    function downloadPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const filename = getFilename() + ".pdf";
        const doc = new jsPDF({ unit: "mm", format: "a4" });
        const outputEl = document.getElementById("output");
        doc.html(outputEl, {
          callback: function (doc) {
            doc.save(filename);
          },
          x: 10,
          y: 10,
          width: doc.internal.pageSize.getWidth() - 20,
          windowWidth: outputEl.scrollWidth
        });
      } catch (error) {
        console.error("PDF generation error:", error);
        showError("Failed to generate PDF. Please try again.");
      }
    }
    function downloadWord() {
      try {
        const { Document, Paragraph, TextRun, HeadingLevel, Packer } = window.docx;
        const sections = [];
        const questionsParagraphs = generatedContent.questions.split("\n").map(
          line => new Paragraph({ children: [new TextRun(line)], spacing: { after: 100 } })
        );
        sections.push({
          properties: {},
          children: [
            new Paragraph({ text: "Exam Paper", heading: HeadingLevel.HEADING_1, spacing: { after: 200 } }),
            ...questionsParagraphs
          ]
        });
        if (document.getElementById("separate-answer-sheet").checked && generatedContent.answers) {
          const answersParagraphs = generatedContent.answers.split("\n").map(
            line => new Paragraph({ children: [new TextRun(line)], spacing: { after: 100 } })
          );
          sections.push({
            properties: {},
            children: [
              new Paragraph({ text: "Answer Key", heading: HeadingLevel.HEADING_1, spacing: { after: 200 } }),
              ...answersParagraphs
            ]
          });
        }
        const doc = new Document({
          creator: "QuizForge",
          title: "Exam Paper",
          description: "Generated exam paper",
          sections
        });
        const filename = getFilename() + ".docx";
        Packer.toBlob(doc).then(blob => {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          showStatus("Word document downloaded successfully!", "success");
        });
      } catch (error) {
        console.error("Word generation error:", error);
        showError("Failed to generate Word document. Please try again.");
      }
    }
    function downloadTXT() {
      try {
        const filename = getFilename() + ".txt";
        let content = generatedContent.questions;
        if (document.getElementById("separate-answer-sheet").checked && generatedContent.answers) {
          content += "\n\n" + generatedContent.answers;
        }
        const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus("Text file downloaded successfully!", "success");
      } catch (error) {
        console.error("TXT download error:", error);
        showError("Failed to generate text file. Please try again.");
      }
    }
  </script>
</body>
</html>
